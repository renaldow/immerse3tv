<!DOCTYPE html>

<html>

<head>
    <title>Example 08.08 - Load collada model </title>

    <meta charset="utf-8">
            <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <script type="text/javascript" src="libs/three.js"></script>
    <script type="text/javascript" src="libs/ColladaLoader.js"></script>

    <script type="text/javascript" src="libs/stats.js"></script>
    <script type="text/javascript" src="libs/dat.gui.js"></script>

    <script type="text/javascript" src="libs/TrackballControls.js"></script>
    <script type="text/javascript" src="libs/tween.min.js"></script>

    <script type="text/javascript" src="libs/chroma.js"></script>
    <script type="text/javascript" src="libs/FlyControls.js"></script>
    <script type="text/javascript" src="libs/RollControls.js"></script>

    <script type="text/javascript" src="js/modes.js"></script>


    <style>
        body {
            /* set margin to 0 and overflow to hidden, to go fullscreen */
            margin: 0;
            overflow: hidden;
        }

        .firstdirections {
            margin-top: 5%;
            margin-left: 5%;
            width: 370px;
            height: 440px;
            border-radius: 3px;
            position: absolute;
            background-color: white;
            display: inline;
            box-shadow: 8px 9px 20px rgba(88, 85, 85, 0.49);
        }

        .heartLabel {
            text-align: center;
            vertical-align: middle;
            height: 40px;
            background-color: #44abda;
            line-height: 40px;
            font-family: avenir;
            font-weight: bold;
            color: #ffffff;
        }

        .heartInstructions {
            height: 100px;
            padding: 20px 5px 20px 0px;
            font-size: 20px;
            color: #44abda;
        }

        ol li { 
            padding:0 0 0 0px;
            margin:0 0 20px 0px;
        }

    </style>
</head>
<body>

<div id="Stats-output">

<div class="firstdirections">
    
    <div class="heartLabel">Directions</div>

    <div class="heartInstructions">
  
        <ol>
          <li>As the heart rotates, you'll be asked various questions.</li>
          <li>Get a question correct and gain 3 points each time.</li>
          <li>Get a question wrong and lose 1 point.</li>
        </ol>  
          
    </div>

</div>

</div>
<!-- Div which will hold the Output -->
<div id="WebGL-output">
</div>

<!-- <audio loop="loop" autoplay="autoplay">
  <source src="assets/audio/heartSound.mp3" type="audio/mpeg">
Your browser does not support the audio element.
</audio> -->

<!-- Javascript code that runs our Three.js examples -->
<script type="text/javascript">

    // once everything is loaded, we run our Three.js stuff.

    var webGLRenderer;
    var scene;
    var camera;
    var DEBUG = true;

    var ANIMATION_MODE = ANIMATION.REGULAR;

    function init() {

        var stats = initStats();
        var clock = new THREE.Clock();
        var cameraPointZone = 0;
        var animationNotStarted = true;


        // create a scene, that will hold all our elements such as objects, cameras and lights.
        scene = new THREE.Scene();

        var webGLdiv = document.getElementById('WebGL-output');
        webGLdiv.style.cursor = 'pointer';
        // webGLdiv.onclick = function() {

        //     if(animationNotStarted) {
        //     //runAnimation();
        //     animationNotStarted = false; }
        // };


         // create a camera, which defines where we're looking at.
        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);

                //show axes in the screen
        var axes = new THREE.AxisHelper(80);
        scene.add(axes);

        // position and point the camera to the center of the scene
        camera.position.x = 30;
        camera.position.y = 30;
        camera.position.z = 80;

        camera.rotation.x = 0;
        camera.rotation.y = 0;
        camera.rotation.z = 0;

        //camera.lookAt(new THREE.Vector3(0, 20, 0));

                // create a render and set the size
        webGLRenderer = new THREE.WebGLRenderer();
        webGLRenderer.setClearColor(new THREE.Color("#990000", 1.0));
        webGLRenderer.setSize(window.innerWidth, window.innerHeight);
        webGLRenderer.shadowMapEnabled = true;

         // add the output of the renderer to the html element
        document.getElementById("WebGL-output").appendChild(webGLRenderer.domElement);

        // add spotlight for the shadows
        var spotLight = new THREE.SpotLight(0xffffff);
        spotLight.position.set(150, 150, 150);
        spotLight.intensity = 2;
        scene.add(spotLight);

        var rollControls;
        var trackballControls;
        var flyControls;
        // model from http://www.thingiverse.com/thing:69709
        var loader = new THREE.ColladaLoader();
    
         loader.load("assets/models/dae/FinalHeart.dae", function (result) {
            mesh = result.scene.children[2].children[0].clone();
            mesh.scale.set(4, 4, 4);

            console.log("Heart Mesh")
            console.dir(mesh);

            console.log("Camera Mesh")
            console.dir(camera);

            console.log("Sphere Follow Mesh")
            console.dir(sphereCameraFollow);

            tweenHeartBeatUp.start();
            scene.add(mesh);

    //          trackballControls = new THREE.TrackballControls(camera, webGLRenderer.domElement);
    //         trackballControls.rotateSpeed = 4.0;
    //         trackballControls.zoomSpeed = 1.0;
    //         trackballControls.panSpeed = 1.0;
    // //        trackballControls.noZoom=false;
    // //        trackballControls.noPan=false;
    //         trackballControls.staticMoving = true;

            // rollControls = new THREE.RollControls(camera);

            // rollControls.movementSpeed = 1;
            // rollControls.lookSpeed = 1;

            //  flyControls = new THREE.FlyControls(camera);

            // flyControls.movementSpeed = 10;
            // flyControls.domElement = document.querySelector("#WebGL-output");
            // flyControls.rollSpeed = Math.PI / 24;
            // flyControls.autoForward = false;
            // flyControls.dragToLook = true;

            //console.log("Rolls Control")
                    //console.dir(rollControls);

        });





        document.addEventListener('keydown', onDocumentKeyDown, false);
        document.addEventListener('mousemove', onDocumentMouseMove, false);

        




       


       //trackballControls.dynamicDampingFactor=0.3;






        // setup the control gui
        var controls = new function () {
            // we need the first child, since it's a multimaterial

            this.ballX = 0;
            this.ballY = 40;
            this.ballZ = 0;

            this.printCoordinates = false;
            this.startAnimation = false;
            this.disableRotation = true;

            this.cameratween = false;

            this.wireframe1 = true;
            this.wireframe2 = true;
            this.wireframe3 = true;

            this.followSphere = false;

            this.rollsmode = false;

        };

        var gui = new dat.GUI();
            // gui.add(controls, 'cameraX', -1000, 1000);
            // gui.add(controls, 'cameraY', -1000, 1000);
            // gui.add(controls, 'cameraZ', -1000, 1000);
            gui.add(controls, 'printCoordinates').onChange(function (e) {

            // console.log("Camera Position X:" + camera.position.x + "  Y:" + camera.position.y + "  Z:" + camera.position.z);

                //console.log("Camera Position: " + camera.position);

                

            });

            gui.add(controls, 'ballX', -1000, 1000);

            gui.add(controls, 'ballY', -1000, 1000);

            gui.add(controls, 'ballZ', -1000, 1000);

            gui.add(controls, 'rollsmode').onChange(function (e) {

                if(e) { 
                    ANIMATION_MODE = ANIMATION.LOOK_AROUND;
                } else {
                    ANIMATION_MODE = ANIMATION.REGULAR;
                }

            });

            gui.add(controls, 'wireframe1');

            gui.add(controls, 'wireframe2');
            gui.add(controls, 'wireframe3');

            gui.add(controls, 'followSphere');


            gui.add(controls, 'disableRotation');

            gui.add(controls, 'startAnimation').onChange(function (e) {

                runAnimation();

            });


             gui.add(controls, 'cameratween').onChange(function (e) { 

                cameraPointZone = 1;

                var cameraRotStart = { Rx:2.86 , Ry:-1.24, Rz:2.9}
                var cameraRotEnd = { Rx:sphere.position.x , Ry:sphere.position.y, Rz:sphere.position.z }

                // var cameratween = new TWEEN.Tween(cameraRotStart).to(cameraRotEnd, 3000);
                // cameratween.easing(TWEEN.Easing.Sinusoidal.InOut).onUpdate(function() {

                    

                //     camera.rotation.x = this.Rx;
                //     camera.rotation.y = this.Ry;
                //     camera.rotation.z = this.Rz;

                //     console.log("Camera Rotation:" + this.Rx + " Ry:" + this.Ry + " Rz:" + this.Rz);

                // });


                //     cameratween.start();
                });
        
        // var tween = new TWEEN.Tween(coords)
        //     .to({ x: 100, y: 100 }, 1000)
        //     .onUpdate(function() {
        //         console.log(this.x, this.y);
        //     })
        //     .start();

        //requestAnimationFrame(animate);


        gui.width = 300;
        //dat.GUI.toggleHide()

        //console.dir(gui);

        var mesh;

        var sphere = createMesh(new THREE.SphereGeometry(1, 20, 20, 6, 6, 0, 3));
        // add the sphere to the scene
        scene.add(sphere);

        sphere.position.x = -5;
        sphere.position.y = 15;
        sphere.position.z = -10;

        sphere.visible = false;
        sphere.intensity = 1.5;

        var sphere2 = createMesh(new THREE.SphereGeometry(1, 20, 20, 6, 6, 0, 3));
        // add the sphere to the scene
        scene.add(sphere2);

        sphere2.position.x = 15;
        sphere2.position.y = 3;
        sphere2.position.z = -10;

        sphere2.visible = true;
        sphere2.intensity = 1.5;


        var sphereCameraFollow = createMesh(new THREE.SphereGeometry(1, 20, 20, 6, 6, 0, 3));
        // add the sphere to the scene
        scene.add(sphereCameraFollow);

        sphereCameraFollow.position.x = 0;
        sphereCameraFollow.position.y = 0;
        sphereCameraFollow.position.z = 0;

        sphereCameraFollow.visible = true;

        //camera.lookAt(sphereCameraFollow.position);  


        var pointColor = "#ff5808";
        var directionalLight = new THREE.PointLight(pointColor);
        directionalLight.position.x = -5;
        directionalLight.position.y = 15;
        directionalLight.position.z = -10;


//        directionalLight.distance = 0;
//        directionalLight.intensity = 0.5;


        scene.add(directionalLight);

        //console.dir(directionalLight);


        //console.dir(sphere);
        

        var sizeSrc = {size: 4};
        var tweenHeartBeatUp = new TWEEN.Tween(sizeSrc).to({size: 4.5}, 500);
        tweenHeartBeatUp.easing(TWEEN.Easing.Sinusoidal.InOut);

        var tweenHeartBeatDown = new TWEEN.Tween(sizeSrc).to({size: 4}, 500);
        tweenHeartBeatDown.easing(TWEEN.Easing.Sinusoidal.InOut);

        tweenHeartBeatUp.chain(tweenHeartBeatDown);
        tweenHeartBeatDown.chain(tweenHeartBeatUp);

        var onUpdate = function () {
            var count = 0;
            var size = this.size;

            mesh.scale.set(size, size, size);
        };

        tweenHeartBeatUp.onUpdate(onUpdate);
        tweenHeartBeatDown.onUpdate(onUpdate);

       

        window.addEventListener('resize', onResize, false);



        render();


        function onResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            webGLRenderer.setSize(window.innerWidth, window.innerHeight);
        }
        

        function runAnimation() {
            //FIRST MOVE

                
                var duration = 2000;

                var coordsPosStart = { Px: 30, Py: 30, Pz:80};
                var coordsPosEnd = { Px: -30, Py: 30, Pz:80};

                var tween1 = tweenToLocation(coordsPosStart, coordsPosEnd, duration, ANIMATION.REGULAR);


                var coordsPosStart = coordsPosEnd;
                var coordsPosEnd = { Px: -70, Py: 30, Pz:0};

                var tween2 = tweenToLocation(coordsPosStart, coordsPosEnd, duration, ANIMATION.REGULAR);


                var coordsPosStart = coordsPosEnd;
                var coordsPosEnd = { Px: -50, Py: 30, Pz:-40};

                var tween3 = tweenToLocation(coordsPosStart, coordsPosEnd, duration, ANIMATION.REGULAR);

                var coordsPosStart = coordsPosEnd;
                var coordsPosEnd = { Px: -10, Py: 18, Pz:-17};

                var tween4 = tweenToLocation(coordsPosStart, coordsPosEnd, duration, ANIMATION.REGULAR);

                var coordsCamPosStart = coordsPosEnd;
                var coordsCamPosEnd = { Px: -4.35, Py: 12.35, Pz:-14.17};

                var tween5 = tweenToLocation(coordsCamPosStart, coordsCamPosEnd, duration, ANIMATION.REGULAR);

                var coordsSpherePosStart = { Px: 0, Py: 0, Pz: 0};
                var coordsSpherePosEnd = { Px: 7, Py: 4, Pz:-4};

                var tween5Sphere = tweenToLocationSphere(coordsSpherePosStart, coordsSpherePosEnd, 1000, ANIMATION.REGULAR);

                
                // var coordsCamPosStart = coordsCamPosEnd;
                // var coordsCamPosEnd = { Px: -4.35, Py: 12.35, Pz:-14.17};

                // var tween6 = tweenToLocation(coordsPosStart, coordsPosEnd, duration);

                // var coordsPosStart = { Px: 0, Py: 0, Pz: 0};
                // var coordsPosEnd = { Px: 0, Py: 8, Pz:-12};

                // var tween6Sphere = tweenToLocationSphere(coordsPosStart, coordsPosEnd, 1000);


                tween1.chain(tween2);

                tween2.chain(tween3);

                tween3.chain(tween4);

                tween4.chain(tween5, tween5Sphere);

                tween1.start();


                // coordsPosStart = coordsPosEnd;
                // coordsPosEnd = { Px:-56.89, Py:24.91, Pz:64.15,  Rx:2.86,  Ry:-1.24, Rz:2.90};

                // var tween2 = tweenToLocation(coordsPosStart, coordsPosEnd, 3000);


                // coordsPosStart = coordsPosEnd;
                // coordsPosEnd = { Px:-86.87, Py:8.27, Pz:18.56,  Rx:2.86,  Ry:-1.24, Rz:2.90};

                // var tween3 = tweenToLocation(coordsPosStart, coordsPosEnd, 3000);


                // coordsPosStart = coordsPosEnd;
                // coordsPosEnd = { Px:-88.88, Py:0.40, Pz:0.00,  Rx:2.86,  Ry:-1.24, Rz:2.90};

                //var tween4 = tweenToLocation(coordsPosStart, coordsPosEnd, 3000);

                // coordsPosStart = coordsPosEnd;
                // coordsPosEnd = { Px:-83.38, Py:0.40, Pz:-30.85,  Rx:2.86,  Ry:-1.24, Rz:2.90};

                // var tween2 = tweenToLocation(coordsPosStart, coordsPosEnd, duration);

                // coordsPosStart = coordsPosEnd;
                // coordsPosEnd = { Px:-56.01, Py:31.21, Pz:-34.16,  Rx:-2.40,  Ry:-0.88, Rz:-2.53};

                // var tween3 = tweenToLocation(coordsPosStart, coordsPosEnd, duration);

                // coordsPosStart = coordsPosEnd;
                // coordsPosEnd = { Px:-27.38, Py:34.33, Pz:-14.07,  Rx:-1.96,  Ry:-0.64, Rz:-2.17};

                // var tween4 = tweenToLocation(coordsPosStart, coordsPosEnd, duration);

                // coordsPosStart = coordsPosEnd;
                // coordsPosEnd = { Px:-16.46, Py:28.43, Pz:-14.69,  Rx:-2.05,  Ry:-0.48, Rz:-2.42};

                // var tween5 = tweenToLocation(coordsPosStart, coordsPosEnd, duration);

                // coordsPosStart = coordsPosEnd;
                // coordsPosEnd = { Px:-10.55, Py:22.04, Pz:-10.10,  Rx:-2.00,  Ry:-0.41, Rz:-2.43};

                // var tween6 = tweenToLocation(coordsPosStart, coordsPosEnd, duration);

                // coordsPosStart = coordsPosEnd;
                // coordsPosEnd = { Px:-7.42, Py:18.71, Pz:-9.94,  Rx:-2.06,  Ry:-0.34, Rz:-2.58};

                // var tween7 = tweenToLocation(coordsPosStart, coordsPosEnd, duration);

                // //coordsPosStart = coordsPosEnd;
                // //coordsPosEnd = { Px:-6.68, Py:16.91, Pz:-9.04,  Rx:-2.06,  Ry:-0.34, Rz:-2.59};

                // //var tween8 = tweenToLocation(coordsPosStart, coordsPosEnd, 3000);


                // coordsPosStart = coordsPosEnd;
                // coordsPosEnd = { Px:-4.81, Py:19.05, Pz:-8.73,  Rx:-2.00,  Ry:-0.23, Rz:-2.69};

                // var tween9 = tweenToLocation(coordsPosStart, coordsPosEnd, duration);

                // coordsPosStart = coordsPosEnd;
                // coordsPosEnd = { Px:4.35, Py:17.47, Pz:-7.49,  Rx:-1.87,  Ry:-0.20, Rz:2.66};

                // var tween10 = new TWEEN.Tween(coordsPosStart).to(coordsPosEnd, duration);
                // tween10.easing(TWEEN.Easing.Linear.None).onUpdate(function() {

                //     camera.position.x = this.Px;
                //     camera.position.y = this.Py;
                //     camera.position.z = this.Pz;

                //     camera.rotation.x = this.Rx;
                //     camera.rotation.y = this.Ry;
                //     camera.rotation.z = this.Rz;

                //     console.log("Px:" + this.Px + " Py:" + this.Py + " Pz:" + this.Pz + " Rx:" + this.Rx + " Ry:" + this.Ry + " Rz:" + this.Rz);

                // });


                // tween7.onComplete(function() {

                //     var delayMillis = 500; //1 second

                //     setTimeout(function() {
                //       cameraPointZone = 1;

                //       coordsPosStart = { Px:-7.42, Py:18.71, Pz:-9.94,  Rx:-2.06,  Ry:-0.34, Rz:-2.58};
                //     coordsPosEnd = { Px:-7.42, Py:18.71, Pz:-9.94,  Rx:-2.06,  Ry:-0.34, Rz:-2.58};

                //     //var tween10 = new TWEEN.Tween(coordsPosStart).to(coordsPosEnd, 2000);

                    

                //     }, delayMillis);



                //     //tween10.start();
                  
                // });
               
                

                //tween1.chain(tween2);
                // tween2.chain(tween3);
                // tween3.chain(tween4);
                // tween4.chain(tween5);
                // tween5.chain(tween6);
                // tween6.chain(tween7);
                //tween7.chain(tween10);
                //tween8.chain(tween9);
                //tween9.chain(tween10);
                // tween2.chain(tween3);
                // tween3.chain(tween4);
                // tween4.chain(tween5);
                
                //tween1.start();

                // var tween2 = new TWEEN.Tween(coordsPos).to(coordsPosEnd, 2000);
                // tween2.easing(TWEEN.Easing.Sinusoidal.InOut).onUpdate(function() {

                //     console.log(this.x + " " + this.y + " " + this.z);

                // });
        }

        function onDocumentKeyDown(event) {

            //Number(1.341).toFixed(2);

            if(animationNotStarted) {
            //runAnimation();
            }

            if(ANIMATION_MODE == ANIMATION.LOOK_AROUND) { 

                var step = 5;
                var UpDown = sphereCameraFollow.position.y;
                var leftRight = sphereCameraFollow.position.z;
            

                if (event.keyCode == 38 && UpDown <= 30) { //UP
                    
                        //ANIMATION_MODE = ANIMATION.LOOK_AROUND;
                        var yMoveUp = sphereCameraFollow.position.y + step;

                        var cameraPosStart = { Px:sphereCameraFollow.position.x , Py:sphereCameraFollow.position.y, Pz:sphereCameraFollow.position.z}
                        var cameraPosEnd = { Px:sphereCameraFollow.position.x , Py: yMoveUp, Pz:sphereCameraFollow.position.z }

                        var cameratween = tweenToLocationSphere(cameraPosStart, cameraPosEnd, 1000, ANIMATION_MODE);


                        //sphereCameraFollow.position.y += step;
                        UpDown = yMoveUp;

                        cameratween.start();
                                     
                    }
                    else if( event.keyCode == 40 && UpDown >= -5) { // DOWN
                        //ANIMATION_MODE = ANIMATION.REGULAR;

                        var yMoveDown = sphereCameraFollow.position.y - step;

                        var cameraPosStart = { Px:sphereCameraFollow.position.x , Py:sphereCameraFollow.position.y, Pz:sphereCameraFollow.position.z}
                        var cameraPosEnd = { Px:sphereCameraFollow.position.x , Py: yMoveDown, Pz:sphereCameraFollow.position.z }

                        var cameratween = tweenToLocationSphere(cameraPosStart, cameraPosEnd, 1000, ANIMATION_MODE);


                        //sphereCameraFollow.position.y += step;
                        UpDown = yMoveDown;

                        cameratween.start();

                    }
                    else if( event.keyCode == 37 && leftRight >= -20) { // LEFT
                        //ANIMATION_MODE = ANIMATION.REGULAR;

                        var zMoveLeft = sphereCameraFollow.position.z - step;

                        var cameraPosStart = { Px:sphereCameraFollow.position.x , Py:sphereCameraFollow.position.y, Pz:sphereCameraFollow.position.z}
                        var cameraPosEnd = { Px:sphereCameraFollow.position.x , Py: sphereCameraFollow.position.y, Pz: zMoveLeft }

                        var cameratween = tweenToLocationSphere(cameraPosStart, cameraPosEnd, 1000, ANIMATION_MODE);


                        //sphereCameraFollow.position.y += step;
                        leftRight = zMoveLeft;

                        cameratween.start();


                    }
                    else if( event.keyCode == 39 && leftRight <= 50) { // RIGHT
                        //ANIMATION_MODE = ANIMATION.REGULAR;

                        var zMoveRigt = sphereCameraFollow.position.z + step;

                        var cameraPosStart = { Px:sphereCameraFollow.position.x , Py:sphereCameraFollow.position.y, Pz:sphereCameraFollow.position.z}
                        var cameraPosEnd = { Px:sphereCameraFollow.position.x , Py: sphereCameraFollow.position.y, Pz: zMoveRigt }

                        var cameratween = tweenToLocationSphere(cameraPosStart, cameraPosEnd, 1000, ANIMATION_MODE);


                        //sphereCameraFollow.position.y += step;
                        leftRight = zMoveRigt;

                        cameratween.start();
                    }

                
            }


            

            console.log("Camera Px:" + Number(camera.position.x).toFixed(2) + ", Py:" + Number(camera.position.y).toFixed(2) + ", Pz:" + Number(camera.position.z).toFixed(2) + ",  Rx:" + Number(camera.rotation.x).toFixed(2) + ",  Ry:" + Number(camera.rotation.y).toFixed(2) + ", Rz:" + Number(camera.rotation.z).toFixed(2));

            // console.dir(sphere);

            // console.dir(sphere2);

            // console.dir(camera);

            // console.dir(spotLight);
        }

        function onDocumentMouseMove( event ) {

            //var vector = new THREE.Vector3(( event.clientX / window.innerWidth ) * 2 - 1, -( event.clientY / window.innerHeight ) * 2 + 1, 0.5);

            //vector = vector.unproject(camera);

            //camera.lookAt(vector);

            // sphereCameraFollow.position.x = vector.x;
            // sphereCameraFollow.position.y = vector.y;
            // sphereCameraFollow.position.z = vector.z;

                var xCord = event.clientX;
                var yCord = event.clientY;

                var xPercent = xCord/window.innerWidth;
                var yPercent = yCord/window.innerHeight;


                //var step = 5;
                var UpDown = sphereCameraFollow.position.y;
                var leftRight = sphereCameraFollow.position.z;

                var yUpperLimit = 30;
                var yRange = 35;
                var zLowerLimit = -20;
                var zRange = 70;
                    
                //ANIMATION_MODE = ANIMATION.LOOK_AROUND;
                var positionYRange = yPercent * yRange;
                var positionY = yUpperLimit - positionYRange;
                var positionZRange = xPercent * zRange;
                var positionZ = zLowerLimit + positionZRange;


                if(ANIMATION_MODE == ANIMATION.LOOK_AROUND) { 

                    var cameraPosStart = { Px:sphereCameraFollow.position.x , Py:sphereCameraFollow.position.y, Pz:sphereCameraFollow.position.z }

                    var cameraPosEnd = { Px:sphereCameraFollow.position.x , Py: positionY, Pz:positionZ }

                    var cameratween = tweenToLocationSphere(cameraPosStart, cameraPosEnd, 1000, ANIMATION_MODE);

                    cameratween.start();
                                                      
                }


            console.log(" positionYRange:" + positionYRange + " : positionY:" + positionY + ": positionZRange:" + positionZRange + ": positionZ:" + positionZ + ": xPercent:" + xPercent);

        }

        function tweenToLocation(coordsPosStart, coordsPosEnd, duration, mode) {

            var tween = new TWEEN.Tween(coordsPosStart).to(coordsPosEnd, duration);

            tween.easing(TWEEN.Easing.Sinusoidal.InOut).onUpdate(function() {

                camera.position.x = this.Px;
                camera.position.y = this.Py;
                camera.position.z = this.Pz;

                // camera.rotation.x = this.Rx;
                // camera.rotation.y = this.Ry;
                // camera.rotation.z = this.Rz;

                if(DEBUG)
                {
                    console.log("Camera: Px:" + this.Px + " Py:" + this.Py + " Pz:" + this.Pz);

                    console.log("Heart Mesh")
                    console.dir(mesh);

                    console.log("Camera Mesh")
                    console.dir(camera);

                    console.log("Sphere Follow Mesh")
                    console.dir(sphereCameraFollow);
                }
            
                //console.dir(camera);

            });

            ANIMATION_MODE = mode;


            return tween;
        }


        function tweenToLocationSphere(coordsPosStart, coordsPosEnd, duration, mode) {

            var tween = new TWEEN.Tween(coordsPosStart).to(coordsPosEnd, duration);

            tween.easing(TWEEN.Easing.Sinusoidal.InOut).onUpdate(function() {

                sphereCameraFollow.position.x = this.Px;
                sphereCameraFollow.position.y = this.Py;
                sphereCameraFollow.position.z = this.Pz;

                if(DEBUG)
                {
                    console.log("Sphere: Px:" + this.Px + " Py:" + this.Py + " Pz:" + this.Pz);

                    console.log("Heart Mesh")
                    console.dir(mesh);

                    console.log("Camera Mesh")
                    console.dir(camera);

                    console.log("Sphere Follow Mesh")
                    console.dir(sphereCameraFollow);
                }

            });

            ANIMATION_MODE = mode;



            return tween;
        }

        function createMesh(geom) {

            // assign two materials
            var meshMaterial = new THREE.MeshNormalMaterial();
            meshMaterial.side = THREE.DoubleSide;
            var wireFrameMat = new THREE.MeshBasicMaterial();
            wireFrameMat.wireframe = true;

            // create a multimaterial
            var mesh = THREE.SceneUtils.createMultiMaterialObject(geom, [meshMaterial, wireFrameMat]);

            // mesh.opacity = 0.5;
            // mesh.transparency = true;

            return mesh;
        }

        function render() {
            stats.update();

            TWEEN.update();

            // render using requestAnimationFrame

            // if(mesh && controls.disableRotation) {
            //     camera.lookAt(mesh.position);
            // }

            switch (cameraPointZone) {
                case 0: //center of heart
                    
                    if(mesh && controls.disableRotation) {
                        //camera.lookAt(mesh.position);
                    }

                    spotLight.target = scene;

                    break;
                case 1:
                    
                    spotLight.target = sphere;

                    //camera.lookAt(sphere2);
                    //camera.lookAt(sphere.position);

                    //camera.position.x = 4.35; 
                    //camera.position.y = 17.47;
                    //camera.position.z = -7.49;


                    break; 
                }

           

            if (mesh) {
                //   mesh.rotation.y+=0.006;

                    mesh.material.materials[0].wireframe = controls.wireframe1;
                    mesh.material.materials[1].wireframe = controls.wireframe2;
                    mesh.material.materials[2].wireframe = controls.wireframe3;
            }


           
            // sphere.position.x = controls.ballX;
            // sphere.position.y = controls.ballY;
            // sphere.position.z = controls.ballZ;


             var delta = clock.getDelta();

             // if(flyControls) { 
             // webGLRenderer.clear();
             //    rollControls.update(delta); }

             if(DEBUG && trackballControls) {
                
                //webGLRenderer.clear();
                //flyControls.update(delta);

               
                    //trackballControls.update(delta);
                
                
            } 

            switch (ANIMATION_MODE) {
                case ANIMATION.REGULAR: 
                    if(camera) { 

                    camera.lookAt(sphereCameraFollow.position);            
                    }

                   break; 
                case ANIMATION.LOOK_AROUND:
                    camera.lookAt(sphereCameraFollow.position); 
                    

                    //camera.position.set(camera.position.x, camera.position.y, camera.position.z)
                    
                    break; 
                }

            
            // camera.position.x = controls.cameraX;
            // camera.position.y = controls.cameraY;
            // camera.position.z = controls.cameraZ;

            spotLight.position.set(camera.position.x, camera.position.y, camera.position.z);

            //spotLight.position.set(scene.position);

            requestAnimationFrame(render);
            webGLRenderer.render(scene, camera);
        }

        function initStats() {

            var stats = new Stats();
            stats.setMode(0); // 0: fps, 1: ms

            // Align top-left
            stats.domElement.style.position = 'absolute';
            stats.domElement.style.left = '0px';
            stats.domElement.style.top = '0px';
            stats.domElement.style.display = "none";

            document.getElementById("Stats-output").appendChild(stats.domElement);

            return stats;
        }
    }

    


    window.onload = init;
</script>
</body>
</html>

